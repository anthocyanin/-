###今日在线商品
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd hh:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd hh:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time < 1535990400 
		and 
		end_time > 1535904000
		and 
		audit_status=1 
		and 
		status=1
		and 
		app_shop_id in(18532,19141,19268,19347,20471,18335,18164,17801)
)t1
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id



###今日新增商品
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd HH:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd HH:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time >= 1536076800 
		and 
		start_time < 1536163200
		and 
		audit_status=1 
		and 
		status=1
		and 
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t1
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id



###昨日商品在今日下架
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd hh:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd hh:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time < 1535904000 ---昨日结束时间 2018/9/3 0:0:0
		and 
		end_time > 1535817600 ---昨日开始时间 2018/9/2 0:0:0
		and 
		audit_status=1 
		and 
		status=1
)t1
left join
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time < 1535990400 ---今天结束时间 2018/9/4 0:0:0
		and 
		end_time > 1535904000 ---今天开始时间 2018/9/3 0:0:0
		and 
		audit_status=1 
		and 
		status=1
)t4
on t1.ad_id=t4.ad_id
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id
where t4.commission_rate is null




第二种方法
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd hh:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd hh:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		end_time > 1535817600 
		and 
		end_time <= 1535904000
		and 
		audit_status=1 
		and 
		status=1
		and 
		app_shop_id in(18532,19141,19268,19347,20471,18335,18164,17801)
)t1
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id






###昨日动销商品
select 
  	t2.shop_id,
  	t2.shop_title,
 	count(distinct t1.product_id)
from
(
	select 
 		product_id,
 		cck_uid
	from 
		origin_common.cc_ods_dwxk_wk_sales_deal_ctime
	where 
		ds='${start_date}'
)t1
join
(
	select
 		cck_uid
	from 
		origin_common.cc_ods_dwxk_fs_wk_cck_user 
	where 
		ds='${start_date}'
		and 
		platform=14
)t3
on t1.cck_uid=t3.cck_uid
left join
(
	select
 		distinct 
 		product_id, 
 		shop_id,
 		shop_title
	from 
		data.cc_dw_fs_products_shops
)t2
on 
	t1.product_id=t2.product_id
group by 
	t2.shop_id,
	t2.shop_title








select
	max(modify_time)
from cc_ods_dwxk_fs_wk_ad_items









###昨日所有在线商品，店铺维度
select
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	count(distinct app_item_id) as product_count
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time < 1536768000 ---昨日结束时间from_unixtime(start_time,'yyyyMMdd hh:mm:ss')
		and 
    	end_time > 1536681600 ---昨日开始时间
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id not in(18636)
)t1
left join
(
	select
		item_id,
		app_item_id
	from origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id
group by t1.app_shop_id,t3.shop_title





###今日所有在线商品，店铺维度
select
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	count(distinct app_item_id) as product_count
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price
	from origin_common.cc_ods_dwxk_fs_wk_ad_items
	where 
		start_time < 1536854400 ---今日结束时间
		and 
    	end_time > 1536768000 ---今日开始时间
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id not in(18636)
)t1
left join
(
	select
		item_id,
		app_item_id
	from origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id
group by t1.app_shop_id,t3.shop_title





###昨日下架商品（昨日在线商品左连今日在线商品），商品维度
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd HH:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd HH:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		ad_name,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily ---天级更新
	where 
		start_time < 1536768000 ---昨日结束时间 2018/9/3 0:0:0
		and 
		end_time > 1536681600 ---昨日开始时间 2018/9/2 0:0:0
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t1
left join
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_dwxk_fs_wk_ad_items ---只有在推广商品
	where 
		start_time < 1536854400 ---今天结束时间 2018/9/4 0:0:0
		and 
		end_time > 1536768000 ---今天开始时间 2018/9/3 0:0:0
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t4
on t1.ad_id=t4.ad_id
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
    	distinct
    	product_id,
    	product_title,
        shop_id,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id
where t4.commission_rate is null





###今日上新商品(今日在线商品左连昨日在线商品），商品维度
select
	t2.app_item_id as product_id,
	t1.ad_name as ad_name,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd HH:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd HH:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time,
		ad_name
	from 
		origin_common.cc_ods_dwxk_fs_wk_ad_items ---只有在推广商品
	where 
		start_time < 1536854400 ---今天结束时间 2018/9/4 0:0:0
		and 
		end_time > 1536768000 ---今天开始时间 2018/9/3 0:0:0
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t1
left join
(
	select
		item_id,
		ad_id,
		ad_name,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily ---天级更新
	where 
		start_time < 1536768000 ---昨日结束时间 2018/9/3 0:0:0
		and 
		end_time > 1536681600 ---昨日开始时间 2018/9/2 0:0:0
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t4
on t1.ad_id=t4.ad_id
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
    	product_id,
    	product_title,
        shop_id,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id
where t4.commission_rate is null






###昨日动销店铺数、动销商品数
select
	distinct
	t5.shop_id
	(case
	when t5.shop_id in(19903,20305,20322) then '百诺优品'
	when t5.shop_id in(18470) then '冰冰购'
	when t5.shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t5.shop_id in(18635,18240) then '极便利'
	when t5.shop_id in(17791,18731) then '京东'
	when t5.shop_id in(18704,18636) then '每日优鲜'
	when t5.shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t5.shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t5.shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t5.shop_id in(18455) then '严选'
	when t5.shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t5.shop_id in(18335,18164,17801) then '自营'
	when t5.shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab
from
(
	select
		cck_uid,
    	product_id,
    	third_tradeno, 
    	item_price,
    	commission
	from  
		origin_common.cc_ods_dwxk_wk_sales_deal_ctime
	where 
		ds='${start_date}'
)t1
join
(
	select
    	cck_uid
	from  
		origin_common.cc_ods_dwxk_fs_wk_cck_user
	where 
		ds='${start_date}' 
		and 
		platform=14
)t2
on t1.cck_uid=t2.cck_uid
left join
(
	select
		product_id,
		shop_id
	from data.cc_dw_fs_products_shops
)t5
on t1.product_id=t5.product_id






select
	distinct
	t5.shop_id,
	t1.product_id
from
(
	select
		cck_uid,
    	product_id,
    	third_tradeno, 
    	item_price,
    	commission
	from  
		origin_common.cc_ods_dwxk_wk_sales_deal_ctime
	where 
		ds='${start_date}'
)t1
join
(
	select
    	cck_uid
	from  
		origin_common.cc_ods_dwxk_fs_wk_cck_user
	where 
		ds='${start_date}' 
		and 
		platform=14
)t2
on t1.cck_uid=t2.cck_uid
left join
(
	select
		product_id,
		shop_id
	from data.cc_dw_fs_products_shops
)t5
on t1.product_id=t5.product_id








###昨日动销店铺数、动销商品数、ipv、分享次数
select
	t5.shop_id,
	(case
	when t5.shop_id in(19903,20305,20322) then '百诺优品'
	when t5.shop_id in(18470) then '冰冰购'
	when t5.shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t5.shop_id in(18635,18240) then '极便利'
	when t5.shop_id in(17791,18731) then '京东'
	when t5.shop_id in(18704,18636) then '每日优鲜'
	when t5.shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t5.shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t5.shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t5.shop_id in(18455) then '严选'
	when t5.shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t5.shop_id in(18335,18164,17801) then '自营'
	when t5.shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	t1.product_id,
	t3.ipv_uv,
	t4.fx_cnt,
	count(distinct t1.third_tradeno) as pay_count,
	sum(item_price/100) as pay_fee
from
(
	select
		cck_uid,
    	product_id,
    	third_tradeno, 
    	item_price,
    	commission
	from  
		origin_common.cc_ods_dwxk_wk_sales_deal_ctime
	where 
		ds='${start_date}'
)t1
join
(
	select
    	cck_uid
	from  
		origin_common.cc_ods_dwxk_fs_wk_cck_user
	where 
		ds='${start_date}' 
		and 
		platform=14
)t2
on t1.cck_uid=t2.cck_uid
left join
(
	select
		a1.product_id,
		sum(a1.ipv_uv) as ipv_uv
	from
	(
		select
			ds,
			product_id,
			count(distinct user_id) as ipv_uv
		from
			origin_common.cc_ods_log_cctui_product_coupon_detail_hourly
		where
			ds= '${start_date}' 
			and
			detail_type='item'
		group by
			ds,
			product_id
	)a1
	group by
		a1.product_id
)t3
on t1.product_id=t3.product_id
left join
(
	select
		m3.product_id,
	    count(m1.user_id) as fx_cnt
	from
	(
		select
	        ad_material_id as ad_id,
	        user_id
	    from 
	        origin_common.cc_ods_log_cctapp_click_hourly
	    where 
	        ds= '${start_date}' 
			and 
			ad_type in ('search','category') and module in ('detail','detail_app') and zone = 'spread'
	    union all
	    select
	        ad_id,
	        user_id
	    from 
	        origin_common.cc_ods_log_cctapp_click_hourly
	    where 
	        ds= '${start_date}' 
			and 
			ad_type not in ('search','category') and module in ('detail','detail_app') and zone = 'spread'
	    union all
	    select
	        s2.ad_id,
	        s1.user_id
	    from
	    (
	    	select
	            ad_material_id,
	            user_id
	        from
	            origin_common.cc_ods_log_cctapp_click_hourly
	        where 
	            ds= '${start_date}' 
				and
				module='vip' and ad_type in ('single_product','9_cell') and zone in ('material_group-share','material_moments-share')
	    ) s1
	    inner join
	    (
	    	select
	            distinct ad_material_id as ad_material_id,
	            ad_id
	        from 
	            data.cc_dm_gwapp_new_ad_material_relation_hourly
	        where 
	            ds= '${start_date}' 
				
	    ) s2
	    on  
	    	s1.ad_material_id = s2.ad_material_id
	) as m1
	inner join
	(
		select
	        ad_id,
	        item_id
	    from 
	        origin_common.cc_ods_fs_dwxk_ad_items_daily
	) m2
	on 
	    m1.ad_id = m2.ad_id
	inner join
	(
		select
	        item_id,
	        app_item_id as product_id
	    from 
	        origin_common.cc_ods_dwxk_fs_wk_items
	) m3
	on 
	    m3.item_id = m2.item_id
	group by
	    m3.product_id
)t4
on t1.product_id=t4.product_id
left join
(
	select
		product_id,
		shop_id
	from data.cc_dw_fs_products_shops
)t5
on t1.product_id=t5.product_id
group by
	t5.shop_id,t1.product_id,t3.ipv_uv,t4.fx_cnt











###昨日新增商品（以推广时间来判断，实际可能存在推广时间在昨日之前，直到昨天才审核通过的商品）
###新增商品暂用今日在线商品左连昨日在线商品来提取
select
	t2.app_item_id as product_id,
	t3.product_title as product_title,
	t1.app_shop_id as shop_id,
	t3.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	cast((t1.cck_price/100)/(t1.cck_rate/1000) as decimal(20,1)) as discount_price,
	cast((t1.commission_rate/1000) as decimal(20,2)) as commission_rate,
	from_unixtime(t1.start_time,'yyyyMMdd HH:mm:ss') as start_time,
	from_unixtime(t1.end_time,'yyyyMMdd HH:mm:ss') as end_time
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price,
		start_time,
		end_time
	from 
		origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time >= 1536076800 ---昨日开始时间
		and 
		start_time < 1536163200 ---昨日结束时间
		and 
		audit_status=1 
		and 
		status=1
		and 
		app_shop_id in(18944,19125,18911,18860,18722,18281,18110,18757,18212,18611,18323,18714,18678,18664,18683,18649,18686,18709,18685,18708,18690,18676,18277,18693,18692,18608,18674,18537,18673,18684,18398,18633,18472,18447,9565,12016,18575,18442,18514,18640,18625,18590,18374,18595,18576,18494,18533,18579,18546,18510,18547,18518,18404,12502,18471,18526,14661,2776,18516,18501,18467,18505,18243,18502,18492,18901,19127,18878,14560,17114,16907,10338,17200,18065,15279,18217,17815,16315,13278,18196,17624,17648,18226,17684,18224,17839,17697,17809,18007,16439,17218,8036,17831,17582,10668,17698,17699,17819,17820,17686,14359,17461,17888,954,15801,18117,18197,17726,17947,9601,17692,18255,17884,18309,8839,11760,18002,14515,11677,17428,1374,17957,9241,5529,17944,16717,17896,12929,8032,17500,14975,13352,16819,18241,16814,18304,11184,13896,16530,18285,18142,4128,8106,17705,5138,8089,5666,18091,16510,9151,8481,7479,533,17690,9238,16270,16567,6521,18330,1796,17704,17769,16561,4121,17653,17951,17531,10078,15811,10141,18417,11548,17850,12922,13773,9250,10036,17902,16798,17851,17649,16743,9772,17982,17597,8270,7992,17405,8622,18317,18238,496,9912,13879,17315,17950,2995,18382,17005,17920,10878,17913,18161,16298,9665,17757,18385,18133,11646,14502,13589,266,16785,10639,168,14390,6621,12545,18174,17776,18145,16540,18338,17665,17788,16355,12846,16538,9950,12854,17961,7199,16853,16741,16286,16896,11137,17167,16687,12924,17349,17981,17645,16878,17707,16375,18363,16581,8756,17768,17644,17939,17137,17441,17522,11102,17693,18080,17926,18123,18177,18210,11279,17483,3133,17748,18430,17501,15519,10097,18060,13805,6427,18294,18394,9182,12889,9961,11449,8553,18047,9691,14005,15688,17172,17152,11445,17012,11237,7647,10671,9570,16650,18034,3826,11242,18103,17337,965,17490,18035,11845,182,9342,18937,19171,18963,19250,19277,18288,19286,19284,18846,19190,17356,19137,19331,17931,19370,19211,18112,19411,18907,19412,18158,18475,19391,18917,18250,19344,19561,19585,19560,18769,19475,19507,19497,17702,14082,19434,19604,19633,19636,19700,19597,16531,12964,3533,19732,18719,8339,18927,19697,19908,19766,19570,18682,19496,12704,19330,19759,19767,19884,20233,7780,20201,20246,19426,18179,20243,10064,19698,20297,20294,20260,20325,20350,20003,19230,18168,11982,17439,19600,19313,20342,20166,19595,20335,18415,18432,11336,18495,19210,17485,20393,19574,18873,19209,20431,653,17300,17530,17516,20205,20351,20401,19236,19528,20481,20399,20458,19491,11568,20413,20499,19500,19866,20427,20493,20443,20546,20500,3646,4457,17115,20492,20506,19139,19651,20505,20452,20541,20539,19333,20545,20285,20503,9974,20573,19384,18647,18176,20411,19913,20534,18552,11520,20601,18744,20449,20336,20537,19687,18512,20604,20007,19338,20327,19675,19903,20305,20322,18470,18532,19141,19268,19347,20471,18635,18240,17791,18731,18704,18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871,18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965,18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653,18455,18335,18164,17801,19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654)
)t1
left join
(
	select
		item_id,
		app_item_id
	from 
		origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
    select
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t3
on t2.app_item_id=t3.product_id

























select
	t1.app_shop_id as shop_id,
	t4.shop_title as shop_title,
	(case
	when t1.app_shop_id in(19903,20305,20322) then '百诺优品'
	when t1.app_shop_id in(18470) then '冰冰购'
	when t1.app_shop_id in(18532,19141,19268,19347,20471) then '代发'
	when t1.app_shop_id in(18635,18240) then '极便利'
	when t1.app_shop_id in(17791,18731) then '京东'
	when t1.app_shop_id in(18704,18636) then '每日优鲜'
	when t1.app_shop_id in(18730,18723,18542,17636,18482,19089,19667,20203,20314,20343,20065,20548,18871) then '其他'
	when t1.app_shop_id in(18898,18735,18848,18662,18558,18896,18775,18891,18729,18733,18543,18815,18245,17772,18588,18740,18849,18799,18893,19543,18581,18660,18666,19572,19254,19319,18535,18408,18582,18488,18732,19405,19441,18303,18400,19257,19085,17303,18655,18671,19402,19530,19869,18883,20216,18965) then '生鲜'
	when t1.app_shop_id in(18706,18586,18569,18262,19392,18606,15426,18314,19534,2873,19708,2369,9872,19871,19756,19755,19709,16851,20179,17691,20242,456,3559,13930,15907,20513,20652,20653) then '小团子'
	when t1.app_shop_id in(18455) then '严选'
	when t1.app_shop_id in(18838,19239,19505,19504,19486,19470,19404,19527,19521,19525,19542,19613,19609,19599,19580,19664,19701,19699,19683,19682,19678,19765,19742,19722,19753,20016,19906,19907,20063,20064,20178,20168,20236,20237,20202,20188) then '一亩田'
	when t1.app_shop_id in(18335,18164,17801) then '自营'
	when t1.app_shop_id in(19310,18928,19324,18746,19361,19340,19339,19432,19468,19298,19444,19410,19421,19506,18508,19476,19519,19552,18531,19545,19546,18491,19611,18436,19435,18500,19665,19749,19764,19891,18765,19870,19894,20109,20142,20273,20249,20292,19905,20332,18574,20334,20392,20423,20422,20444,20543,20549,20600,20588,20621,20620,20636,20655,20638,20654) then '总监店铺'
	else 'POP' end) as tab,
	count(distinct t2.app_item_id) as product_count,
	count(t3.shop_id) as moving_shops,
	count(t3.product_id) as moving_products
from
(
	select
		item_id,
		ad_id,
		app_shop_id,
		ad_price,
		commission_rate,
		cck_rate,
		cck_price
	from origin_common.cc_ods_fs_dwxk_ad_items_daily
	where 
		start_time < 1536076800 ---昨日结束时间
		and 
    	end_time > 1535990400 ---昨日开始时间
		and 
		audit_status=1 
		and 
		status=1
		and
		app_shop_id in()
)t1
left join
(
	select
		item_id,
		app_item_id
	from origin_common.cc_ods_dwxk_fs_wk_items
)t2
on t1.item_id=t2.item_id
left join
(
	select 
		distinct
  		g3.shop_id,
  		g1.product_id
	from
	(
		select 
 			product_id,
 			cck_uid
		from 
			origin_common.cc_ods_dwxk_wk_sales_deal_ctime
		where 
			ds='${start_date}'
	)g1
	join
	(
		select
	 		cck_uid
		from 
			origin_common.cc_ods_dwxk_fs_wk_cck_user 
		where 
			ds='${start_date}'
			and 
			platform=14
	)g2
	on g1.cck_uid=g3.cck_uid
	left join
	(
		select
	 		distinct 
	 		product_id, 
	 		shop_id,
	 		shop_title
		from 
			data.cc_dw_fs_products_shops
	)g3
	on 
		g1.product_id=g3.product_id
)t3
on t1.app_shop_id=t3.shop_id
left join
(
    select
    	distinct
        product_id,
        product_title,
        shop_title
    from 
        data.cc_dw_fs_products_shops
)t4
on t2.app_item_id=t4.product_id
group by t1.app_shop_id,t3.shop_title




